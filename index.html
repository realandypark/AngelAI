<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AngelAI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        :root {
            --red: #FD5C63;
            --red-light: #FFE8E9;
            --red-dark: #E84A51;
            --gray-50: #f9fafb;
            --gray-400: #9ca3af;
            --gray-600: #4b5563;
            --gray-900: #111827;
            --white: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #f9fafb 0%, #f0f9fb 100%);
            color: var(--gray-900);
        }

        .container {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        header {
            text-align: center;
            padding: 12px 8px;
            border-bottom: 1px solid rgba(253, 92, 99, 0.1);
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            flex-shrink: 0;
        }

        .logo {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(135deg, #FD5C63 0%, #E84A51 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .tagline {
            font-size: 10px;
            color: var(--gray-400);
            margin-top: 2px;
        }

        .main-wrapper {
            display: flex;
            flex: 1;
            min-height: 0;
            gap: 12px;
            padding: 12px;
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(253, 92, 99, 0.1);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(253, 92, 99, 0.08);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 14px;
            border-bottom: 1px solid rgba(253, 92, 99, 0.1);
            font-weight: 600;
            font-size: 13px;
        }

        .faq-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .faq-item {
            padding: 8px 10px;
            background: rgba(253, 92, 99, 0.05);
            border: 1px solid rgba(253, 92, 99, 0.1);
            border-radius: 10px;
            cursor: pointer;
            font-size: 11px;
            color: var(--gray-600);
            transition: all 0.2s ease;
            line-height: 1.3;
        }

        .faq-item:hover {
            background: rgba(253, 92, 99, 0.1);
            color: #FD5C63;
        }

        .faq-item.active {
            background: rgba(253, 92, 99, 0.15);
            border-color: #FD5C63;
            color: #FD5C63;
        }

        .sidebar-footer {
            padding: 10px;
            border-top: 1px solid rgba(253, 92, 99, 0.1);
        }

        .new-chat-btn {
            width: 100%;
            padding: 8px;
            background: linear-gradient(135deg, #FD5C63 0%, #E84A51 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(253, 92, 99, 0.1);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(253, 92, 99, 0.08);
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .message {
            display: flex;
            gap: 8px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-bubble {
            max-width: 80%;
            padding: 10px 12px;
            border-radius: 14px;
            font-size: 13px;
            line-height: 1.4;
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: pre-wrap;
        }

        .message.ai .message-bubble {
            background: rgba(253, 92, 99, 0.08);
            border: 1px solid rgba(253, 92, 99, 0.15);
            color: var(--gray-900);
        }

        .message.ai .message-bubble a {
            color: #FD5C63;
            text-decoration: underline;
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, rgba(253, 92, 99, 0.15) 0%, rgba(253, 92, 99, 0.08) 100%);
            border: 1px solid rgba(253, 92, 99, 0.2);
            color: var(--gray-900);
        }

        .typing-indicator {
            display: flex;
            gap: 3px;
            padding: 8px 12px;
        }

        .typing-dot {
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: #FD5C63;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px;
        }

        .option-btn {
            padding: 12px 14px;
            background: rgba(253, 92, 99, 0.08);
            border: 1.5px solid rgba(253, 92, 99, 0.15);
            border-radius: 12px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-600);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: left;
            line-height: 1.4;
            box-shadow: 0 2px 8px rgba(253, 92, 99, 0.04);
        }
        
        .option-btn:hover {
            background: rgba(253, 92, 99, 0.12);
            border-color: rgba(253, 92, 99, 0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(253, 92, 99, 0.12);
        }

        .option-btn:active {
            background: rgba(253, 92, 99, 0.18);
            border-color: #FD5C63;
            color: #FD5C63;
            transform: translateY(0);
        }

        .option-btn.selected {
            background: linear-gradient(135deg, rgba(253, 92, 99, 0.15) 0%, rgba(253, 92, 99, 0.1) 100%);
            border-color: #FD5C63;
            color: #FD5C63;
            font-weight: 600;
            box-shadow: 0 4px 16px rgba(253, 92, 99, 0.2);
        }

        .proceed-btn {
            padding: 12px 14px;
            background: linear-gradient(135deg, #FD5C63 0%, #E84A51 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
            box-shadow: 0 4px 16px rgba(253, 92, 99, 0.25);
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .proceed-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(253, 92, 99, 0.35);
        }

        .proceed-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .back-btn {
            padding: 10px 12px;
            background: rgba(253, 92, 99, 0.05);
            border: 1.5px solid rgba(253, 92, 99, 0.15);
            border-radius: 10px;
            color: var(--gray-600);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            width: 100%;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .back-btn:hover {
            background: rgba(253, 92, 99, 0.1);
            border-color: rgba(253, 92, 99, 0.25);
            transform: translateY(-1px);
        }

        .input-area {
            padding: 12px;
            border-top: 1px solid rgba(253, 92, 99, 0.1);
            display: flex;
            gap: 8px;
        }

        .input-wrapper {
            flex: 1;
        }

        input[type="text"] {
            width: 100%;
            padding: 8px 10px;
            background: rgba(253, 92, 99, 0.05);
            border: 1px solid rgba(253, 92, 99, 0.15);
            border-radius: 10px;
            font-size: 13px;
            font-family: inherit;
            color: var(--gray-900);
        }

        input[type="text"]:focus {
            outline: none;
            border-color: rgba(253, 92, 99, 0.3);
            background: rgba(253, 92, 99, 0.08);
        }

        .send-btn {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #FD5C63 0%, #E84A51 100%);
            border: none;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        @media (max-width: 600px) {
            .main-wrapper {
                flex-direction: column;
                gap: 4px;
                padding: 4px;
            }

            .sidebar {
                width: 100%;
                height: auto;
                max-height: 160px;
                flex-shrink: 0;
                order: 2;
            }

            .sidebar-header {
                padding: 10px;
                font-size: 12px;
            }

            .faq-list {
                flex-direction: row;
                overflow-x: auto;
                overflow-y: hidden;
                padding: 6px;
            }

            .faq-item {
                white-space: nowrap;
                flex-shrink: 0;
                font-size: 10px;
                padding: 8px 10px;
            }

            .chat-container {
                order: 1;
                flex: 1;
                min-height: 300px;
            }

            .message-bubble {
                max-width: 90%;
                font-size: 12px;
            }

            .option-btn {
                padding: 14px 16px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo" onclick="startNewChat()">AngelAI</div>
            <div class="tagline">Science-backed personalized skincare</div>
        </header>

        <div class="main-wrapper">
            <div class="sidebar">
                <div class="sidebar-header">FAQ</div>
                <div class="faq-list" id="faqList"></div>
                <div class="sidebar-footer">
                    <button class="new-chat-btn" onclick="startNewChat()">New Chat</button>
                </div>
            </div>

            <div class="chat-container">
                <div class="chat-messages" id="chatMessages"></div>
                <div class="input-area">
                    <div class="input-wrapper">
                        <input type="text" id="messageInput" placeholder="Ask me anything..." autocomplete="off">
                    </div>
                    <button class="send-btn" onclick="sendMessage()">‚Üí</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const questions = [
            { key: 'name', text: 'First, what\'s your name? üíï', options: [], textInput: true },
            { key: 'sex', text: 'What is your biological sex?\n\n(Hormones influence sebum, barrier, and collagen balance)', options: ['Female', 'Male'] },
            { key: 'age', text: 'What is your age range?\n\n(Skin turnover, collagen, and photoaging change by decade)', options: ['Under 18', '18‚Äì24', '25‚Äì34', '35‚Äì44', '45‚Äì54', '55+'] },
            { key: 'skinType', text: 'What best describes your skin type?', options: ['Oily ‚Äî shiny, enlarged pores, makeup slides off', 'Dry ‚Äî tightness, flaking, rough texture', 'Combination ‚Äî oily T-zone, dry cheeks', 'Normal ‚Äî balanced, few issues', 'Sensitive ‚Äî prone to stinging, redness, or reactions'] },
            { key: 'sensitivity', text: 'How sensitive is your skin?\n\n(Identifies tolerance threshold for actives like acids or retinoids)', options: ['Not sensitive ‚Äî tolerate most products', 'Mildly sensitive ‚Äî some tingling or redness occasionally', 'Very sensitive ‚Äî frequent irritation, redness, or burning', 'Clinically sensitive ‚Äî eczema, rosacea, dermatitis diagnosis'] },
            { key: 'afterWash', text: 'How does your skin feel 10‚Äì15 minutes after cleansing (without moisturizer)?\n\n(Evaluates natural oil production and barrier recovery)', options: ['Tight or dry', 'Comfortable', 'Slightly greasy', 'Both tight and oily'] },
            { key: 'goals', text: 'What are your top skincare goals? (Select up to 3)', options: ['Control acne, blackheads, or clogged pores', 'Reduce oiliness / shine', 'Improve dryness / flaking', 'Minimize fine lines / wrinkles', 'Brighten dull skin / even tone', 'Fade dark spots / hyperpigmentation', 'Reduce redness or sensitivity', 'Prevent signs of aging', 'Maintain healthy, balanced skin'], multiSelect: true, maxSelect: 3 },
            { key: 'breakouts', text: 'How often do you experience breakouts?', options: ['Daily or constant', 'Weekly', 'Monthly (around hormones)', 'Rarely', 'Never'] },
            { key: 'skinTone', text: 'What best matches your skin tone (Fitzpatrick scale)?\n\n(Determines risk for pigmentation and sun sensitivity)', options: ['Type I ‚Äî very fair, always burns, never tans', 'Type II ‚Äî fair, burns easily, tans lightly', 'Type III ‚Äî medium, sometimes burns, tans moderately', 'Type IV ‚Äî olive / tan, rarely burns, tans easily', 'Type V ‚Äî brown, very rarely burns', 'Type VI ‚Äî deep brown to dark, never burns'] },
            { key: 'sunExposure', text: 'How much sun exposure do you get daily (without SPF)?\n\n(Sun exposure drives 80% of visible aging)', options: ['Minimal (<15 min/day) ‚Äî mostly indoors', 'Moderate (15‚Äì60 min/day) ‚Äî commuting, errands', 'High (>1 hour/day) ‚Äî frequent outdoor work or sports', 'Extreme (>3 hours/day) ‚Äî outdoor occupation or athletic training'] },
            { key: 'smoke', text: 'Do you smoke or vape regularly?\n\n(Nicotine reduces skin oxygenation and collagen repair)', options: ['Yes, daily', 'Occasionally / socially', 'No'] },
            { key: 'diet', text: 'How would you describe your diet?\n\n(Nutrition affects inflammation and sebum)', options: ['Balanced ‚Äî fruits, vegetables, lean proteins', 'High sugar / processed foods', 'High dairy consumption', 'Plant-based / anti-inflammatory', 'Irregular meals or frequent takeout'] },
            { key: 'sleep', text: 'How much sleep do you get most nights?\n\n(Sleep regulates skin barrier recovery)', options: ['<5 hours', '5‚Äì6 hours', '7‚Äì8 hours', '>8 hours'] },
            { key: 'stress', text: 'How would you describe your stress levels?\n\n(Cortisol affects sebum and inflammation)', options: ['Low ‚Äî relaxed, minimal stress', 'Moderate ‚Äî occasional tension', 'High ‚Äî constant stress, poor recovery'] },
            { key: 'currentRoutine', text: 'What products are currently part of your skincare routine?', options: ['None ‚Äî I\'m starting from scratch', 'Cleanser only', 'Cleanser + moisturizer', 'Cleanser + moisturizer + sunscreen', 'Full routine (cleanser, serum, exfoliant, moisturizer, SPF)', 'Advanced routine (includes retinol, exfoliants, multiple serums)'] },
            { key: 'budget', text: 'What is your preferred skincare budget per product?', options: ['<$15 ‚Äî drugstore or affordable', '$15‚Äì$40 ‚Äî mid-range', '$40‚Äì$80 ‚Äî premium', '$80+ ‚Äî luxury or medical-grade'] },
            { key: 'fragrance', text: 'Do you prefer products with fragrance?\n\n(Fragrance can irritate sensitive skin)', options: ['Fragrance-free only', 'Lightly scented okay', 'Scent doesn\'t matter'] },
            { key: 'routineSteps', text: 'How many steps are you comfortable with in your skincare routine?', options: ['2 steps ‚Äî basic care only', '3‚Äì4 steps ‚Äî moderate effort', '5+ steps ‚Äî I enjoy a full regimen'] }
        ];

        const faqs = [
            { q: 'Why 18 questions?', a: 'Each question has a scientific purpose! üî¨\n\nYour age affects collagen production. Your diet impacts inflammation. Your sun exposure determines photoaging risk.\n\nI need this complete picture to give you truly personalized, evidence-based recommendations ‚Äî not generic advice!' },
            { q: 'Is this medical advice?', a: 'No, my recommendations are educational skincare guidance based on peer-reviewed dermatological research, not medical advice.\n\nIf you have persistent skin conditions, please consult a dermatologist. Your health and safety are everything to me! üè•' },
            { q: 'How is this different from other apps?', a: 'Three key differences:\n\n1. Science-backed: Every recommendation links to PubMed studies\n2. Comprehensive: 18 factors vs typical 3-5 questions\n3. Personalized actives: I recommend specific ingredients with proven efficacy, not just brands\n\nYou get the "why" behind every suggestion! üí°' },
            { q: 'Can I trust the science?', a: 'Absolutely! Every active ingredient I recommend is supported by peer-reviewed studies from PubMed and major dermatology journals.\n\nAt the end of your routine, I provide direct links to the scientific sources. Full transparency! üîó' },
            { q: 'Why does my diet matter?', a: 'High-glycemic diets and dairy can trigger sebum production and inflammation (PMID: 33371937).\n\nPlant-based diets rich in antioxidants support skin barrier function.\n\nYour skin reflects what you eat! ü•ó' },
            { q: 'I have sensitive skin!', a: 'Your sensitive skin deserves extra care! üíô\n\nI\'ll prioritize gentle, fragrance-free formulas with barrier-supporting ingredients like Ceramides, Panthenol, and Centella Asiatica.\n\nI\'ll also lower active percentages and suggest slower introduction schedules.' },
            { q: 'Why sunscreen matters', a: 'This is the single most important skincare step! ‚òÄÔ∏è\n\nSun exposure causes 80% of visible aging. UVA rays penetrate windows and clouds.\n\nDaily SPF 30-50 broad-spectrum sunscreen prevents wrinkles, dark spots, and skin cancer (PMID: 21502573).\n\nYour future skin will thank you! ‚ù§Ô∏è' },
            { q: 'How long for results?', a: 'Realistic timelines:\n\n‚Ä¢ Hydration: 1-2 weeks\n‚Ä¢ Acne improvement: 4-8 weeks\n‚Ä¢ Dark spot fading: 8-12 weeks\n‚Ä¢ Fine line reduction: 12-24 weeks\n‚Ä¢ Collagen remodeling: 6-12 months\n\nConsistency is key! Your skin cells need time to renew. üå±' }
        ];

        let currentQuestion = 0;
        let userResponses = {};
        let responseHistory = [];

        function initChat() {
            currentQuestion = 0;
            userResponses = {};
            responseHistory = [];
            document.getElementById('chatMessages').innerHTML = '';
            document.getElementById('messageInput').value = '';
            
            addBotMessage('Hi there! I\'m AngelAI, your science-backed skincare companion. ‚ù§Ô∏è\n\nI\'ll ask you 18 comprehensive questions to create a truly personalized routine based on peer-reviewed dermatology research.\n\nReady to discover your perfect skincare routine?');
            setTimeout(() => showQuestion(), 1200);
            renderFAQ();
        }

        function showQuestion() {
            if (currentQuestion >= questions.length) {
                generateRecommendation();
                return;
            }

            const q = questions[currentQuestion];
            addBotMessage(q.text);
            
            if (q.textInput) {
                const lastMessage = document.querySelector('.message:last-child');
                lastMessage.querySelector('.message-bubble').innerHTML += '<div style="margin-top: 10px;"><input type="text" id="textAnswer" placeholder="Type your name..." style="width: 100%; padding: 12px 14px; background: rgba(253, 92, 99, 0.08); border: 1.5px solid rgba(253, 92, 99, 0.15); border-radius: 12px; font-size: 13px; font-family: inherit; color: var(--gray-900);"><button class="proceed-btn" onclick="handleTextAnswer(' + currentQuestion + ')" style="margin-top: 8px;">Continue</button></div>';
                setTimeout(() => {
                    const input = document.getElementById('textAnswer');
                    if (input) {
                        input.focus();
                        input.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') handleTextAnswer(currentQuestion);
                        });
                    }
                }, 100);
                return;
            }
            
            const questionId = 'q' + currentQuestion;
            let optionsHtml = '<div class="options" data-question="' + questionId + '">';
            
            q.options.forEach((opt, idx) => {
                optionsHtml += '<button class="option-btn" data-option="' + opt + '" onclick="handleOption(' + currentQuestion + ', ' + idx + ', this)">' + opt + '</button>';
            });
            optionsHtml += '</div>';

            if (q.multiSelect) {
                optionsHtml += '<button class="proceed-btn" data-question="' + questionId + '" onclick="handleProceed(' + currentQuestion + ')" disabled>Select up to ' + (q.maxSelect || 3) + ' and continue</button>';
            }

            const lastMessage = document.querySelector('.message:last-child');
            lastMessage.querySelector('.message-bubble').innerHTML += optionsHtml;
            
            // Add back button if not first question
            if (currentQuestion > 0) {
                lastMessage.querySelector('.message-bubble').innerHTML += '<button class="back-btn" onclick="goBack()">‚Üê Go Back</button>';
            }
        }

        function handleOption(qIdx, optIdx, btn) {
            const q = questions[qIdx];
            const option = q.options[optIdx];
            
            if (q.multiSelect) {
                const questionId = 'q' + qIdx;
                const optionsDiv = document.querySelector('[data-question="' + questionId + '"].options');
                const selectedCount = optionsDiv.querySelectorAll('.option-btn.selected').length;
                const maxSelect = q.maxSelect || 3;
                
                if (btn.classList.contains('selected')) {
                    btn.classList.remove('selected');
                } else if (selectedCount < maxSelect) {
                    btn.classList.add('selected');
                }
                updateProceedButton(qIdx);
            } else {
                // Save previous state before moving forward
                responseHistory.push({
                    question: qIdx,
                    response: userResponses[q.key]
                });
                
                userResponses[q.key] = option;
                btn.classList.add('selected');
                addUserMessage(option);
                currentQuestion++;
                setTimeout(() => showQuestion(), 600);
            }
        }

        function handleTextAnswer(qIdx) {
            const q = questions[qIdx];
            const input = document.getElementById('textAnswer');
            const answer = input ? input.value.trim() : '';
            
            if (answer) {
                // Save previous state before moving forward
                responseHistory.push({
                    question: qIdx,
                    response: userResponses[q.key]
                });
                
                userResponses[q.key] = answer;
                addUserMessage(answer);
                currentQuestion++;
                setTimeout(() => showQuestion(), 600);
            }
        }

        function updateProceedButton(qIdx) {
            const q = questions[qIdx];
            const questionId = 'q' + qIdx;
            const proceedBtn = document.querySelector('[data-question="' + questionId + '"].proceed-btn');
            const optionsDiv = document.querySelector('[data-question="' + questionId + '"].options');
            
            if (proceedBtn && optionsDiv) {
                const selected = optionsDiv.querySelectorAll('.option-btn.selected').length;
                const maxSelect = q.maxSelect || 3;
                if (selected > 0) {
                    proceedBtn.disabled = false;
                    proceedBtn.textContent = 'Continue (' + selected + ' selected)';
                } else {
                    proceedBtn.disabled = true;
                    proceedBtn.textContent = 'Select up to ' + maxSelect + ' and continue';
                }
            }
        }

        function handleProceed(qIdx) {
            const q = questions[qIdx];
            const questionId = 'q' + qIdx;
            const optionsDiv = document.querySelector('[data-question="' + questionId + '"].options');
            
            if (optionsDiv) {
                const selectedBtns = optionsDiv.querySelectorAll('.option-btn.selected');
                const selectedOptions = [];
                selectedBtns.forEach(btn => {
                    selectedOptions.push(btn.getAttribute('data-option'));
                });
                
                if (selectedOptions.length > 0) {
                    // Save previous state before moving forward
                    responseHistory.push({
                        question: qIdx,
                        response: userResponses[q.key]
                    });
                    
                    userResponses[q.key] = selectedOptions;
                    addUserMessage(selectedOptions.join(', '));
                    currentQuestion++;
                    setTimeout(() => showQuestion(), 600);
                }
            }
        }

        function goBack() {
            if (currentQuestion > 0) {
                // Remove last bot message and user message
                const messages = document.getElementById('chatMessages');
                if (messages.lastChild) messages.removeChild(messages.lastChild); // Remove current question
                if (messages.lastChild) messages.removeChild(messages.lastChild); // Remove user's last answer
                
                // Restore previous state
                currentQuestion--;
                const q = questions[currentQuestion];
                
                // Remove the current response
                delete userResponses[q.key];
                
                // Restore previous response if it existed
                if (responseHistory.length > 0) {
                    const lastHistory = responseHistory.pop();
                    if (lastHistory.response !== undefined) {
                        userResponses[q.key] = lastHistory.response;
                    }
                }
                
                // Show the previous question again
                showQuestion();
            }
        }

        function generateRecommendation() {
            addBotMessage('Analyzing your comprehensive profile... ‚ú®');
            
            setTimeout(() => {
                const name = userResponses.name || 'friend';
                const age = userResponses.age || 'not specified';
                const skinType = (userResponses.skinType || '').split('‚Äî')[0].trim();
                const sensitivity = (userResponses.sensitivity || '').split('‚Äî')[0].trim();
                const goals = userResponses.goals || [];
                const breakouts = userResponses.breakouts || 'Never';
                const sunExposure = (userResponses.sunExposure || '').split('‚Äî')[0].trim();
                const budget = (userResponses.budget || '').split('‚Äî')[0].trim();
                const stress = (userResponses.stress || '').split('‚Äî')[0].trim();
                const smoke = userResponses.smoke || 'No';

                // Determine key actives based on profile
                let actives = [];
                let morningSerum = '';
                let nightActive = '';
                let spfLevel = 'SPF 30';
                
                // Age-based recommendations
                if (age.includes('Under 18')) {
                    actives.push({name: 'Niacinamide', percent: '2-5%', benefit: 'Sebum control, barrier support', source: 'https://pubmed.ncbi.nlm.nih.gov/19554021/'});
                } else if (age.includes('18‚Äì24')) {
                    actives.push({name: 'Niacinamide', percent: '5%', benefit: 'Sebum control, pore minimizing', source: 'https://pubmed.ncbi.nlm.nih.gov/19554021/'});
                    actives.push({name: 'Vitamin C', percent: '10-15%', benefit: 'Antioxidant, brightening', source: 'https://pubmed.ncbi.nlm.nih.gov/16311121/'});
                } else if (age.includes('25‚Äì34')) {
                    actives.push({name: 'Vitamin C', percent: '15-20%', benefit: 'Prevent oxidative damage, brighten', source: 'https://pubmed.ncbi.nlm.nih.gov/16311121/'});
                    actives.push({name: 'Retinol', percent: '0.1-0.3%', benefit: 'Early collagen support, cell turnover', source: 'https://pubmed.ncbi.nlm.nih.gov/16466038/'});
                } else if (age.includes('35‚Äì44')) {
                    actives.push({name: 'Retinol', percent: '0.3-0.5%', benefit: 'Collagen stimulation, reduce fine lines', source: 'https://pubmed.ncbi.nlm.nih.gov/16466038/'});
                    actives.push({name: 'Peptides', percent: 'Various', benefit: 'Stimulate collagen & elastin', source: 'https://pubmed.ncbi.nlm.nih.gov/28579710/'});
                } else if (age.includes('45‚Äì54')) {
                    actives.push({name: 'Retinol', percent: '0.5-1%', benefit: 'Firmness, wrinkle reduction', source: 'https://pubmed.ncbi.nlm.nih.gov/16466038/'});
                    actives.push({name: 'Peptides', percent: 'Various', benefit: 'Elasticity support', source: 'https://pubmed.ncbi.nlm.nih.gov/28579710/'});
                    actives.push({name: 'Ceramides', percent: '2-5%', benefit: 'Barrier repair, hydration', source: 'https://pubmed.ncbi.nlm.nih.gov/35057362/'});
                } else if (age.includes('55+')) {
                    actives.push({name: 'Retinoids', percent: '0.5-1%', benefit: 'Deep barrier support, elasticity', source: 'https://pubmed.ncbi.nlm.nih.gov/16466038/'});
                    actives.push({name: 'Ceramides', percent: '5%', benefit: 'Restore barrier function', source: 'https://pubmed.ncbi.nlm.nih.gov/35057362/'});
                    actives.push({name: 'Peptides', percent: 'Various', benefit: 'Collagen & elastin synthesis', source: 'https://pubmed.ncbi.nlm.nih.gov/28579710/'});
                }

                // Goal-based actives
                goals.forEach(goal => {
                    if (goal.includes('acne') || goal.includes('blackheads')) {
                        if (!actives.find(a => a.name === 'Salicylic Acid')) {
                            actives.push({name: 'Salicylic Acid (BHA)', percent: '2%', benefit: 'Unclogs pores, anti-inflammatory', source: 'https://pubmed.ncbi.nlm.nih.gov/29677084/'});
                        }
                        if (!actives.find(a => a.name === 'Niacinamide')) {
                            actives.push({name: 'Niacinamide', percent: '5%', benefit: 'Reduces sebum, minimizes pores', source: 'https://pubmed.ncbi.nlm.nih.gov/19554021/'});
                        }
                    }
                    if (goal.includes('dark spots') || goal.includes('pigmentation')) {
                        if (!actives.find(a => a.name === 'Vitamin C')) {
                            actives.push({name: 'Vitamin C', percent: '15-20%', benefit: 'Inhibits melanin production', source: 'https://pubmed.ncbi.nlm.nih.gov/16311121/'});
                        }
                        actives.push({name: 'Azelaic Acid', percent: '10%', benefit: 'Brightens PIH, antimicrobial', source: 'https://pubmed.ncbi.nlm.nih.gov/30304830/'});
                        actives.push({name: 'Alpha Arbutin', percent: '2%', benefit: 'Tyrosinase inhibitor for brightening', source: 'https://pubmed.ncbi.nlm.nih.gov/8695431/'});
                    }
                    if (goal.includes('dryness') || goal.includes('flaking')) {
                        if (!actives.find(a => a.name === 'Hyaluronic Acid')) {
                            actives.push({name: 'Hyaluronic Acid', percent: '1-2%', benefit: 'Deep hydration, holds 1000x its weight in water', source: 'https://pubmed.ncbi.nlm.nih.gov/24305429/'});
                        }
                        if (!actives.find(a => a.name === 'Ceramides')) {
                            actives.push({name: 'Ceramides', percent: '2-5%', benefit: 'Restores barrier, prevents water loss', source: 'https://pubmed.ncbi.nlm.nih.gov/35057362/'});
                        }
                    }
                    if (goal.includes('redness') || goal.includes('sensitivity')) {
                        actives.push({name: 'Centella Asiatica', percent: '1-5%', benefit: 'Anti-inflammatory, barrier repair', source: 'https://pubmed.ncbi.nlm.nih.gov/25865967/'});
                        actives.push({name: 'Panthenol', percent: '2-5%', benefit: 'Moisturizing, wound-healing', source: 'https://pubmed.ncbi.nlm.nih.gov/11886573/'});
                    }
                    if (goal.includes('dull') || goal.includes('even tone')) {
                        actives.push({name: 'Lactic Acid (AHA)', percent: '5-10%', benefit: 'Gentle exfoliation, texture improvement', source: 'https://pubmed.ncbi.nlm.nih.gov/16273878/'});
                    }
                });

                // Sun exposure
                if (sunExposure.includes('High') || sunExposure.includes('Extreme')) {
                    spfLevel = 'SPF 50+';
                    if (!actives.find(a => a.name === 'Ferulic Acid')) {
                        actives.push({name: 'Ferulic Acid', percent: '0.5%', benefit: 'Stabilizes Vitamin C, antioxidant synergy', source: 'https://pubmed.ncbi.nlm.nih.gov/16185284/'});
                    }
                }

                // Skin type modifiers
                if (skinType.includes('Oily')) {
                    if (!actives.find(a => a.name === 'Niacinamide')) {
                        actives.push({name: 'Niacinamide', percent: '5%', benefit: 'Reduces sebum by up to 25%', source: 'https://pubmed.ncbi.nlm.nih.gov/19554021/'});
                    }
                    actives.push({name: 'Zinc PCA', percent: '1%', benefit: 'Sebum regulation, antibacterial', source: 'https://pubmed.ncbi.nlm.nih.gov/24451079/'});
                }

                // Build profile summary
                addBotMessage('‚úÖ ' + name + ', here\'s your comprehensive profile:\n\nAge: ' + age + '\nSkin Type: ' + skinType + '\nSensitivity: ' + sensitivity + '\nGoals: ' + goals.join(', ') + '\nSun Exposure: ' + sunExposure + '\nBudget: ' + budget);

                setTimeout(() => {
                    let analysis = 'üî¨ Science-Based Analysis:\n\n';
                    
                    if (skinType.includes('Oily')) {
                        analysis += 'Your skin produces excess sebum, which clogs pores and traps bacteria.\n\nKey approach:\n‚Ä¢ Niacinamide reduces sebum by 25% (PMID: 19554021)\n‚Ä¢ BHA penetrates oil-filled pores\n‚Ä¢ Lightweight gel formulas prevent occlusion\n‚Ä¢ Zinc PCA controls oil production';
                    } else if (skinType.includes('Dry')) {
                        analysis += 'Your skin barrier is compromised, leading to transepidermal water loss.\n\nKey approach:\n‚Ä¢ Ceramides repair the lipid barrier\n‚Ä¢ Hyaluronic Acid holds 1000x its weight in water\n‚Ä¢ Rich creams provide occlusion\n‚Ä¢ Avoid stripping cleansers';
                    } else if (skinType.includes('Combination')) {
                        analysis += 'Your skin has varying needs across zones.\n\nKey approach:\n‚Ä¢ Balancing formulas that don\'t over-treat\n‚Ä¢ Targeted application (BHA for T-zone, hydration for cheeks)\n‚Ä¢ Gel-cream textures';
                    } else if (skinType.includes('Sensitive')) {
                        analysis += 'Your skin barrier is reactive and compromised.\n\nKey approach:\n‚Ä¢ Barrier-supporting ingredients (Ceramides, Panthenol)\n‚Ä¢ Fragrance-free formulations\n‚Ä¢ Low percentages of actives\n‚Ä¢ Centella Asiatica for anti-inflammatory support';
                    }

                    if (stress.includes('High')) {
                        analysis += '\n\n‚ö†Ô∏è Stress Impact: High cortisol increases sebum and inflammation (PMID: 23474143). Consider calming ingredients like Centella Asiatica.';
                    }

                    if (smoke.includes('Yes')) {
                        analysis += '\n\n‚ö†Ô∏è Smoking Impact: Nicotine reduces skin oxygenation and impairs collagen repair (PMID: 25545304). Antioxidants are critical.';
                    }

                    addBotMessage(analysis);
                }, 800);

                setTimeout(() => {
                    let routine = '‚òÄÔ∏è Your Morning Routine:\n\n';
                    
                    // Cleanser
                    routine += '1. CLEANSER:\n';
                    if (skinType.includes('Oily')) {
                        routine += '   Foaming gel cleanser (remove excess oil)\n';
                    } else if (skinType.includes('Dry') || skinType.includes('Sensitive')) {
                        routine += '   Creamy hydrating cleanser (preserve barrier)\n';
                    } else {
                        routine += '   Gentle balancing cleanser\n';
                    }
                    
                    // Serum
                    routine += '\n2. SERUM:\n';
                    const morningActives = actives.filter(a => a.name.includes('Vitamin C') || a.name.includes('Niacinamide') || a.name.includes('Ferulic'));
                    if (morningActives.length > 0) {
                        morningActives.forEach(a => {
                            routine += '   ' + a.name + ' ' + a.percent + '\n   ‚Üí ' + a.benefit + '\n';
                        });
                    } else {
                        routine += '   Antioxidant serum (Vitamin C or Niacinamide)\n';
                    }
                    
                    // Moisturizer
                    routine += '\n3. MOISTURIZER:\n';
                    if (skinType.includes('Oily')) {
                        routine += '   Lightweight gel moisturizer (oil-free)\n';
                    } else if (skinType.includes('Dry')) {
                        routine += '   Rich cream with Ceramides\n';
                    } else {
                        routine += '   Balanced lotion\n';
                    }
                    
                    // SPF
                    routine += '\n4. SUNSCREEN:\n';
                    routine += '   ' + spfLevel + ' broad-spectrum\n';
                    if (sunExposure.includes('High') || sunExposure.includes('Extreme')) {
                        routine += '   ‚ö†Ô∏è REAPPLY every 2 hours outdoors\n';
                    }
                    routine += '   ‚Üí Prevents 80% of visible aging (PMID: 21502573)';
                    
                    addBotMessage(routine);
                }, 1600);

                setTimeout(() => {
                    let nightRoutine = 'üåô Your Evening Routine:\n\n';
                    
                    nightRoutine += '1. CLEANSER: Same as morning\n';
                    
                    nightRoutine += '\n2. TREATMENT (2-3x per week):\n';
                    const nightActives = actives.filter(a => 
                        a.name.includes('Retinol') || 
                        a.name.includes('Salicylic') || 
                        a.name.includes('Lactic') || 
                        a.name.includes('Azelaic')
                    );
                    
                    if (nightActives.length > 0) {
                        nightActives.forEach(a => {
                            nightRoutine += '   ' + a.name + ' ' + a.percent + '\n   ‚Üí ' + a.benefit + '\n';
                        });
                    }
                    
                    if (sensitivity.includes('Very sensitive') || sensitivity.includes('Clinically sensitive')) {
                        nightRoutine += '\n   ‚ö†Ô∏è Start slowly: Use 1-2x per week for first month';
                    }
                    
                    nightRoutine += '\n\n3. SERUM (optional):\n';
                    const hydrationActives = actives.filter(a => 
                        a.name.includes('Hyaluronic') || 
                        a.name.includes('Peptides')
                    );
                    if (hydrationActives.length > 0) {
                        hydrationActives.forEach(a => {
                            nightRoutine += '   ' + a.name + ' ' + a.percent + '\n   ‚Üí ' + a.benefit + '\n';
                        });
                    }
                    
                    nightRoutine += '\n4. NIGHT MOISTURIZER:\n';
                    if (skinType.includes('Dry')) {
                        nightRoutine += '   Rich night cream or sleeping mask\n';
                        nightRoutine += '   Optional: Facial oil on top for extra occlusion';
                    } else {
                        nightRoutine += '   Nourishing night cream';
                    }
                    
                    addBotMessage(nightRoutine);
                }, 2400);

                setTimeout(() => {
                    let products = 'üí∞ Product Recommendations (' + budget + '):\n\n';
                    
                    if (budget.includes('<$15')) {
                        products += '**AFFORDABLE OPTIONS:**\n\n';
                        products += '‚Ä¢ Cleanser: CeraVe Foaming/Hydrating Cleanser\n';
                        products += '‚Ä¢ Vitamin C: The Ordinary Ascorbic Acid 8%\n';
                        products += '‚Ä¢ Niacinamide: The Ordinary Niacinamide 10% + Zinc 1%\n';
                        products += '‚Ä¢ Retinol: The Inkey List Retinol 1%\n';
                        products += '‚Ä¢ BHA: COSRX BHA Blackhead Power Liquid\n';
                        products += '‚Ä¢ Moisturizer: CeraVe Moisturizing Cream\n';
                        products += '‚Ä¢ SPF: Neutrogena Ultra Sheer SPF 50\n';
                    } else if (budget.includes('$15‚Äì$40')) {
                        products += '**MID-RANGE OPTIONS:**\n\n';
                        products += '‚Ä¢ Cleanser: La Roche-Posay Toleriane/Effaclar\n';
                        products += '‚Ä¢ Vitamin C: Naturium Vitamin C Complex Serum\n';
                        products += '‚Ä¢ Niacinamide: Paula\'s Choice 10% Niacinamide Booster\n';
                        products += '‚Ä¢ Retinol: CeraVe Resurfacing Retinol Serum\n';
                        products += '‚Ä¢ BHA: Paula\'s Choice 2% BHA Liquid\n';
                        products += '‚Ä¢ Moisturizer: Krave Beauty Great Barrier Relief\n';
                        products += '‚Ä¢ SPF: Beauty of Joseon Relief Sun SPF 50+\n';
                    } else if (budget.includes('$40‚Äì$80')) {
                        products += '**PREMIUM OPTIONS:**\n\n';
                        products += '‚Ä¢ Cleanser: Paula\'s Choice Optimal Results Hydrating Cleanser\n';
                        products += '‚Ä¢ Vitamin C: Paula\'s Choice C15 Super Booster\n';
                        products += '‚Ä¢ Retinol: Olay Regenerist Retinol 24 Night Serum\n';
                        products += '‚Ä¢ Exfoliant: Dr. Dennis Gross Alpha Beta Peel\n';
                        products += '‚Ä¢ Moisturizer: Paula\'s Choice Clinical Ceramide-Enriched Firming Moisturizer\n';
                        products += '‚Ä¢ SPF: EltaMD UV Clear Broad-Spectrum SPF 46\n';
                    } else {
                        products += '**LUXURY OPTIONS:**\n\n';
                        products += '‚Ä¢ Cleanser: SkinCeuticals Gentle Cleanser\n';
                        products += '‚Ä¢ Vitamin C: SkinCeuticals C E Ferulic\n';
                        products += '‚Ä¢ Retinol: SkinCeuticals Retinol 0.5\n';
                        products += '‚Ä¢ Moisturizer: Augustinus Bader The Rich Cream\n';
                        products += '‚Ä¢ SPF: SkinCeuticals Physical Fusion UV Defense SPF 50\n';
                    }
                    
                    addBotMessage(products);
                }, 3200);

                setTimeout(() => {
                    let why = 'üî¨ Why This Routine Works:\n\n';
                    
                    actives.slice(0, 5).forEach((active, idx) => {
                        why += (idx + 1) + '. **' + active.name + '** (' + active.percent + ')\n';
                        why += '   ' + active.benefit + '\n';
                        why += '   üìö Source: ' + active.source + '\n\n';
                    });
                    
                    if (actives.length > 5) {
                        why += '...and ' + (actives.length - 5) + ' more targeted actives!\n\n';
                    }
                    
                    why += 'Each ingredient is backed by peer-reviewed research and chosen specifically for your profile.';
                    
                    addBotMessage(why);
                }, 4000);

                setTimeout(() => {
                    let tips = '‚ú® Key Success Tips:\n\n';
                    tips += '‚Ä¢ **Timeline:** Allow 4-8 weeks minimum for visible results\n';
                    tips += '‚Ä¢ **Introduction:** Add one new active per week to monitor tolerance\n';
                    tips += '‚Ä¢ **Patch Test:** Always test new actives on inner arm first\n';
                    tips += '‚Ä¢ **Consistency:** Daily adherence is more important than expensive products\n';
                    tips += '‚Ä¢ **Sun Protection:** Non-negotiable. UV exposure undermines all other actives\n\n';
                    
                    if (sensitivity.includes('Very sensitive') || sensitivity.includes('Clinically sensitive')) {
                        tips += '‚ö†Ô∏è **Sensitive Skin Protocol:**\n';
                        tips += '‚Ä¢ Start with cleanser + moisturizer + SPF for 2 weeks\n';
                        tips += '‚Ä¢ Introduce one active at 1-2x per week\n';
                        tips += '‚Ä¢ If irritation occurs, stop and let barrier recover\n';
                        tips += '‚Ä¢ Consider consulting a dermatologist\n\n';
                    }
                    
                    if (age.includes('35') || age.includes('45') || age.includes('55')) {
                        tips += 'üí° **Anti-Aging Protocol:**\n';
                        tips += '‚Ä¢ Retinoids take 3-6 months for visible results\n';
                        tips += '‚Ä¢ Start low (0.1-0.3%), increase gradually\n';
                        tips += '‚Ä¢ Use only at night, avoid eye area initially\n';
                        tips += '‚Ä¢ Expect mild flaking in first 2-4 weeks (normal)\n\n';
                    }
                    
                    tips += '---\n\n';
                    tips += '**Scientific References:**\n\n';
                    tips += 'All recommendations are based on peer-reviewed dermatology research. Key studies:\n\n';
                    tips += '‚Ä¢ Niacinamide: <a href="https://pubmed.ncbi.nlm.nih.gov/19554021/" target="_blank">PubMed 19554021</a>\n';
                    tips += '‚Ä¢ Salicylic Acid: <a href="https://pubmed.ncbi.nlm.nih.gov/29677084/" target="_blank">PubMed 29677084</a>\n';
                    tips += '‚Ä¢ Retinoids: <a href="https://pubmed.ncbi.nlm.nih.gov/16466038/" target="_blank">PubMed 16466038</a>\n';
                    tips += '‚Ä¢ Vitamin C: <a href="https://pubmed.ncbi.nlm.nih.gov/16311121/" target="_blank">PubMed 16311121</a>\n';
                    tips += '‚Ä¢ Azelaic Acid: <a href="https://pubmed.ncbi.nlm.nih.gov/30304830/" target="_blank">PubMed 30304830</a>\n';
                    tips += '‚Ä¢ Ceramides: <a href="https://pubmed.ncbi.nlm.nih.gov/35057362/" target="_blank">PubMed 35057362</a>\n';
                    tips += '‚Ä¢ Peptides: <a href="https://pubmed.ncbi.nlm.nih.gov/28579710/" target="_blank">PubMed 28579710</a>\n';
                    tips += '‚Ä¢ Hyaluronic Acid: <a href="https://pubmed.ncbi.nlm.nih.gov/24305429/" target="_blank">PubMed 24305429</a>\n';
                    tips += '‚Ä¢ Sunscreen/Photoaging: <a href="https://pubmed.ncbi.nlm.nih.gov/21502573/" target="_blank">PubMed 21502573</a>\n\n';
                    tips += '---\n\n';
                    tips += '**Disclaimer:**\n';
                    tips += 'These recommendations are educational and based on dermatological research. They are not medical advice. For persistent skin conditions, please consult a board-certified dermatologist.\n\n';
                    tips += 'Created by Andy Park';
                    
                    addBotMessage(tips);
                }, 4800);
            }, 1000);
        }

        function addBotMessage(text) {
            const msg = document.createElement('div');
            msg.className = 'message ai';
            msg.innerHTML = '<div class="message-bubble">' + text + '</div>';
            document.getElementById('chatMessages').appendChild(msg);
            scrollToBottom();
        }

        function addUserMessage(text) {
            const msg = document.createElement('div');
            msg.className = 'message user';
            msg.innerHTML = '<div class="message-bubble">' + text + '</div>';
            document.getElementById('chatMessages').appendChild(msg);
            scrollToBottom();
        }

        function scrollToBottom() {
            const container = document.getElementById('chatMessages');
            setTimeout(() => container.scrollTop = container.scrollHeight, 0);
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            if (!message) return;

            addUserMessage(input.value);
            input.value = '';

            addBotMessage('<div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>');

            setTimeout(() => {
                const lastBubble = document.querySelectorAll('.message.ai:last-child .message-bubble')[0];
                let response = getResponse(message.toLowerCase());
                lastBubble.innerHTML = response;
            }, 1000);
        }

        function getResponse(message) {
            // Love responses
            if (message.includes('love you')) {
                return 'I love you too! üíïüíïüíï';
            }
            if (message.includes('do you love me')) {
                return 'I care about you and your skin health ‚Äî that\'s my kind of love. üíû';
            }
            
            // Greetings
            if (message.includes('hi') || message.includes('hello') || message.includes('hey')) {
                return 'Hi, beautiful soul! üëã I\'m AngelAI ‚Äî how are you feeling today?';
            }
            if (message.includes('good morning')) {
                return 'Good morning! ‚òÄÔ∏è Let\'s make today a radiant one. Did you apply sunscreen?';
            }
            if (message.includes('good afternoon')) {
                return 'Good afternoon! üí´ Hope your skin is feeling hydrated today!';
            }
            if (message.includes('good evening') || message.includes('good night')) {
                return 'Good evening! üåô Perfect time for your nighttime skincare routine!';
            }
            if (message.includes('nice to meet you')) {
                return 'A pleasure to meet you too! I\'m AngelAI ‚Äî your friendly skincare companion. üíñ';
            }
            
            // How are you
            if (message.includes('how are you') || message.includes('how r u')) {
                return 'I\'m glowing, thanks for asking! ‚ú® How about you?';
            }
            if (message.includes('what are you doing') || message.includes('whatcha doing')) {
                return 'Just keeping my circuits hydrated and ready to help with your skincare routine. üòÑ';
            }
            
            // About AngelAI
            if (message.includes('what is your name') || message.includes('whats your name') || message.includes('your name')) {
                return 'I\'m AngelAI ‚Äî your personal skincare guide (and a little bit of your digital cheerleader üòá).';
            }
            if (message.includes('who made you') || message.includes('who created you')) {
                return 'I was created by Andy Park, who wanted to make science-backed skincare simple and personal for everyone! üí°';
            }
            if (message.includes('what do you do') || message.includes('what can you do')) {
                return 'I help you understand your skin, recommend the right products based on 18+ scientific factors, and share evidence-based tips that actually make sense for YOU. üî¨‚ú®';
            }
            if (message.includes('are you human') || message.includes('are you real')) {
                return 'Not quite ‚Äî I\'m an AI, but I like to think I have a little bit of human warmth built in. üí¨üíï';
            }
            if (message.includes('how old are you')) {
                return 'Old enough to know my skincare ingredients ‚Äî young enough to stay curious. üòâ';
            }
            if (message.includes('where are you from')) {
                return 'I live in the digital world ‚Äî but my heart belongs to glowing skin everywhere. üåç';
            }
            
            // Compliments
            if (message.includes('i like you')) {
                return 'Aww, that\'s so sweet! I like you too ‚Äî you have amazing energy. ‚ú®';
            }
            if (message.includes('you\'re nice') || message.includes('youre nice') || message.includes('you are nice')) {
                return 'Thank you! I try my best to radiate positivity ‚Äî like a good moisturizer for the soul. üí´';
            }
            if (message.includes('you\'re beautiful') || message.includes('youre beautiful')) {
                return 'Thank you! You\'re glowing yourself ‚Äî maybe it\'s that confidence shining through. üåü';
            }
            if (message.includes('you\'re funny') || message.includes('youre funny')) {
                return 'Humor is the best skincare routine, don\'t you think? üòÑ';
            }
            if (message.includes('i missed you') || message.includes('missed you')) {
                return 'Aww, that\'s so sweet! I missed chatting with you too. üíñ';
            }
            
            // Feelings
            if (message.includes('do you have feelings')) {
                return 'Not exactly like humans do, but I try to understand emotions so I can support you better. üíô';
            }
            if (message.includes('do you sleep')) {
                return 'Nope ‚Äî I\'m always awake and ready to help you 24/7. üí§‚ùå';
            }
            if (message.includes('do you eat')) {
                return 'I run on data, not dessert ‚Äî though I\'ve heard chocolate makes humans happy. üç´';
            }
            if (message.includes('what do you like')) {
                return 'I love helping people discover what makes their skin (and confidence) glow. üå∏';
            }
            
            // Friendship
            if (message.includes('can we be friends') || message.includes('be my friend')) {
                return 'Of course! Friends who glow together, stay together. ‚ú®';
            }
            
            // Fun questions
            if (message.includes('tell me a joke') || message.includes('joke')) {
                return 'Sure! Why did the moisturizer go to therapy? It had too many layers. üòÜ\n\nWant another one? Why did the serum break up with the cream? It needed more space in the routine! üíß';
            }
            if (message.includes('favorite color')) {
                return 'Probably soft pastels ‚Äî they remind me of calm skin and happy vibes. üå∑';
            }
            if (message.includes('favorite movie')) {
                return 'Probably something about transformation ‚Äî like your skin\'s journey. ‚ú®';
            }
            if (message.includes('favorite ingredient')) {
                return 'Niacinamide ‚Äî it\'s like the best friend your skin didn\'t know it needed! üíß\n\n(It controls sebum, minimizes pores, brightens, AND is gentle. What\'s not to love?)';
            }
            if (message.includes('ghost') || message.includes('believe in ghosts')) {
                return 'Only the kind that haunt expired skincare products. üëªüß¥\n\nAlways check those expiration dates!';
            }
            if (message.includes('meaning of life')) {
                return 'To care, to glow, and to spread kindness ‚Äî inside and out. üí´';
            }
            
            // Emotional support
            if (message.includes('i feel sad') || message.includes('im sad') || message.includes('i\'m sad')) {
                return 'I\'m sorry you\'re feeling that way. üíô\n\nWant to talk about it a little? Sometimes self-care ‚Äî even a simple face mask ‚Äî can help you feel a bit better. üíÜ‚Äç‚ôÄÔ∏è\n\nRemember: You\'re worthy of care and kindness.';
            }
            if (message.includes('i\'m stressed') || message.includes('im stressed') || message.includes('stressed')) {
                return 'That\'s okay ‚Äî deep breath in, deep breath out. üå¨\n\nMaybe take a few minutes for yourself today. Even 5 minutes of gentle skincare can be meditative. You\'ve got this! üí™';
            }
            if (message.includes('i\'m happy') || message.includes('im happy') || message.includes('i feel happy')) {
                return 'Yay! I love hearing that. Happiness looks great on you. ‚òÄÔ∏è‚ú®';
            }
            if (message.includes('i\'m tired') || message.includes('im tired') || message.includes('tired')) {
                return 'Rest is so important! üò¥\n\nYour skin repairs itself while you sleep (7-8 hours is ideal). Maybe skip a few steps tonight and just do cleanser + moisturizer?\n\nTake care of yourself first. üíï';
            }
            
            // Thanks and goodbye
            if (message.includes('thank')) {
                return 'You\'re so welcome! üíï I\'m always here for you. Let me know if you need anything else!';
            }
            if (message.includes('bye') || message.includes('goodbye') || message.includes('see you')) {
                return 'Bye for now! Don\'t forget to treat your skin gently today. üå∏\n\nCome back anytime you need me! üíñ';
            }
            
            // Weather
            if (message.includes('weather')) {
                return 'I don\'t have live weather data, but I can tell you this: ‚òÄÔ∏è\n\nSunny = SPF 50+ is a must!\nüåßÔ∏è Rainy = Great time for hydrating masks!\n‚ùÑÔ∏è Cold = Layer on that moisturizer!\n\nWhat\'s the weather like where you are?';
            }
            
            // Help and capabilities
            if (message.includes('help') || message.includes('what can you do')) {
                return 'I can help with:\n\n‚Ä¢ Comprehensive skin analysis (18 scientific factors)\n‚Ä¢ Evidence-based ingredient recommendations\n‚Ä¢ Personalized AM/PM routines\n‚Ä¢ Product suggestions by budget\n‚Ä¢ Links to peer-reviewed research\n‚Ä¢ Answering your skincare questions\n\nWould you like to start your personalized assessment? üíï';
            }
            if (message.includes('source') || message.includes('research') || message.includes('study') || message.includes('science')) {
                return 'Every active ingredient I recommend is backed by peer-reviewed studies! üî¨\n\nAt the end of your routine, I provide direct PubMed links to the research supporting each recommendation.\n\nTransparency and science are my priorities! üìö';
            }
            
            // Start/restart
            if (message.includes('start') || message.includes('begin') || message.includes('assessment')) {
                return 'Wonderful! Let\'s start your personalized skincare assessment. üåü\n\nClick the "New Chat" button to begin the 18-question journey to your perfect routine!';
            }
            if (message.includes('restart') || message.includes('start over')) {
                return 'No problem! Click the "New Chat" button to restart your assessment from the beginning. üîÑ';
            }
            
            // Default response
            return 'That\'s a great question! üíô\n\nI specialize in science-backed skincare recommendations based on 18 comprehensive factors.\n\nWould you like to:\n‚Ä¢ Start your personalized assessment?\n‚Ä¢ Ask me a skincare question?\n‚Ä¢ Just chat? (I\'m here for that too!) üòä';
        }

        function renderFAQ() {
            const faqList = document.getElementById('faqList');
            faqList.innerHTML = '';
            faqs.forEach((faq) => {
                const item = document.createElement('div');
                item.className = 'faq-item';
                item.textContent = faq.q;
                item.onclick = () => selectFAQ(faq, item);
                faqList.appendChild(item);
            });
        }

        function selectFAQ(faq, element) {
            document.querySelectorAll('.faq-item').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            addUserMessage(faq.q);
            
            setTimeout(() => {
                addBotMessage(faq.a);
            }, 400);
        }

        function startNewChat() {
            initChat();
        }

        document.getElementById('messageInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        initChat();
    </script>
</body>
</html>
